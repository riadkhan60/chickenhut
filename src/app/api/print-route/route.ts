import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';

// Place your logo as a base64 string here (or load from file if needed)
const LOGO_BASE64 =
  `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`; // TODO: Replace with your actual base64 logo string

const STORE_NAME = 'chicken hut';
const FLASK_PRINT_URL = 'http://localhost:5000/print';
const API_KEY = 'your-secret-api-key';

export async function POST(req: NextRequest) {
  try {
    const { orderId, type } = await req.json();
    if (!orderId || !type) {
      return NextResponse.json(
        { error: 'orderId and type are required' },
        { status: 400 },
      );
    }
    if (type !== 'kitchen' && type !== 'customer') {
      return NextResponse.json(
        { error: 'type must be "kitchen" or "customer"' },
        { status: 400 },
      );
    }

    // Fetch order with items, menu items, and table
    const order = await prisma.order.findUnique({
      where: { id: orderId },
      include: {
        table: true,
        orderItems: {
          include: { menuItem: true },
        },
      },
    });
    if (!order) {
      return NextResponse.json({ error: 'Order not found' }, { status: 404 });
    }

    // Build content for print
    const content: Array<Record<string, unknown>> = [];
    if (type === 'kitchen') {
      // Only item number and table name
      content.push({ type: 'header', text: 'KITCHEN ORDER' });
      content.push({
        type: 'text',
        text: `Table: ${order.isParcel ? 'Parcel' : order.table?.number || ''}`,
      });
      for (const item of order.orderItems) {
        content.push({
          type: 'text',
          text: `#${item.menuItem.itemNumber} x${item.quantity}`,
        });
      }
    } else if (type === 'customer') {
      // Logo, header, items, total, etc.
      if (LOGO_BASE64) {
        content.push({ type: 'image', data: LOGO_BASE64 });
      }
      content.push({ type: 'header', text: STORE_NAME });
      content.push({
        type: 'text',
        text: `Table: ${order.isParcel ? 'Parcel' : order.table?.number || ''}`,
      });
      content.push({ type: 'text', text: `Order #${order.id}` });
      content.push({
        type: 'text',
        text: new Date(order.createdAt).toLocaleString(),
      });
      for (const item of order.orderItems) {
        content.push({
          type: 'item',
          name: item.menuItem.name,
          quantity: item.quantity,
          price: item.price,
        });
      }
      content.push({ type: 'total', amount: order.total });
      if (order.discount && order.discount > 0) {
        content.push({
          type: 'text',
          text: `Discount: -${order.discount.toFixed(2)}`,
        });
      }
      content.push({ type: 'text', text: 'Thank you!' });
    }

    // Send to Flask print server
    const printRes = await fetch(FLASK_PRINT_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-API-KEY': API_KEY,
      },
      body: JSON.stringify({ content }),
    });
    const printData = await printRes.json();
    if (!printRes.ok) {
      return NextResponse.json(
        { error: printData.error || 'Print failed' },
        { status: 500 },
      );
    }
    return NextResponse.json({
      success: true,
      message: printData.message || 'Printed successfully',
    });
  } catch (err: unknown) {
    function hasMessage(e: unknown): e is { message: string } {
      return (
        typeof e === 'object' &&
        e !== null &&
        'message' in e &&
        typeof (e as { message: unknown }).message === 'string'
      );
    }
    let message = 'Internal server error';
    if (hasMessage(err)) {
      message = err.message;
    }
    return NextResponse.json({ error: message }, { status: 500 });
  }
}
